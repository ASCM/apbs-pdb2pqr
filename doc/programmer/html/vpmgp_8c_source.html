<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>APBS: /data/work/source/apbs/src/mg/vpmgp.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">APBS
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('vpmgp_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/data/work/source/apbs/src/mg/vpmgp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="vpmgp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="vpmgp_8h.html" title="Contains declarations for class Vpmgp.">vpmgp.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <a class="code" href="group___vhal.html#ga4b89a5a26de68481d070f76427db33c6" title="Allows embedding of RCS ID tags in object files.">VEMBED</a>(rcsid=<span class="stringliteral">&quot;$Id$&quot;</span>)
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00062"></a>00062 <span class="comment">// Class Vpmgp: Inlineable methods</span>
<a name="l00064"></a>00064 <span class="comment">#if !defined(VINLINE_VACC)</span>
<a name="l00065"></a>00065 <span class="comment">#endif /* if !defined(VINLINE_VACC) */</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00068"></a>00068 <span class="comment">// Class Vpmgp: Non-inlineable methods</span>
<a name="l00070"></a>00070 <span class="comment"></span>
<a name="l00071"></a>00071 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00072"></a>00072 <span class="comment">// Routine:  Vpmgp_ctor</span>
<a name="l00073"></a>00073 <span class="comment">//</span>
<a name="l00074"></a>00074 <span class="comment">// Author:   Nathan Baker</span>
<a name="l00076"></a><a class="code" href="group___vpmgp.html#gacbf93b72154285b4a1789400f6cb5aa2">00076</a> <span class="comment">VPUBLIC Vpmgp* Vpmgp_ctor(MGparm *mgparm) {</span>
<a name="l00077"></a>00077 <span class="comment"></span>
<a name="l00078"></a>00078 <span class="comment">    Vpmgp *thee = VNULL;</span>
<a name="l00079"></a>00079 <span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">    /* Set up the structure */</span>
<a name="l00081"></a>00081     thee = (<a class="code" href="structs_vpmgp.html" title="Contains public data members for Vpmgp class/module.">Vpmgp</a>*)Vmem_malloc(VNULL, 1, sizeof(<a class="code" href="structs_vpmgp.html" title="Contains public data members for Vpmgp class/module.">Vpmgp</a>) );
<a name="l00082"></a>00082     VASSERT( thee != VNULL);
<a name="l00083"></a>00083     VASSERT(<a class="code" href="group___vpmgp.html#ga11a970ff00cb1de38da826b8f1ae6e2a" title="FORTRAN stub to construct PMG parameter object and initialize to default values.">Vpmgp_ctor2</a>(thee,mgparm));
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     return thee;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00089"></a>00089 <span class="comment">// Routine:  Vpmgp_ctor2</span>
<a name="l00090"></a>00090 <span class="comment">//</span>
<a name="l00091"></a>00091 <span class="comment">// Author:   Nathan Baker</span>
<a name="l00093"></a><a class="code" href="group___vpmgp.html#ga11a970ff00cb1de38da826b8f1ae6e2a">00093</a> <span class="comment">VPUBLIC int Vpmgp_ctor2(Vpmgp *thee,MGparm *mgparm) {</span>
<a name="l00094"></a>00094 <span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">    /* Specified parameters */</span>
<a name="l00096"></a>00096     thee-&gt;nx = mgparm-&gt;dime[0];
<a name="l00097"></a>00097     thee-&gt;ny = mgparm-&gt;dime[1];
<a name="l00098"></a>00098     thee-&gt;nz = mgparm-&gt;dime[2];
<a name="l00099"></a>00099     thee-&gt;hx = mgparm-&gt;grid[0];
<a name="l00100"></a>00100     thee-&gt;hy = mgparm-&gt;grid[1];
<a name="l00101"></a>00101     thee-&gt;hzed = mgparm-&gt;grid[2];
<a name="l00102"></a>00102     thee-&gt;xlen = ((<span class="keywordtype">double</span>)(mgparm-&gt;dime[0]-1))*mgparm-&gt;grid[0];
<a name="l00103"></a>00103     thee-&gt;ylen = ((<span class="keywordtype">double</span>)(mgparm-&gt;dime[1]-1))*mgparm-&gt;grid[1];
<a name="l00104"></a>00104     thee-&gt;zlen = ((<span class="keywordtype">double</span>)(mgparm-&gt;dime[2]-1))*mgparm-&gt;grid[2];
<a name="l00105"></a>00105     thee-&gt;nlev = mgparm-&gt;nlev;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     thee-&gt;nonlin = mgparm-&gt;nonlintype;
<a name="l00108"></a>00108     thee-&gt;meth = mgparm-&gt;method;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="preprocessor">#ifdef DEBUG_MAC_OSX_OCL</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#include &quot;mach_chud.h&quot;</span>
<a name="l00112"></a>00112     <span class="keywordflow">if</span>(kOpenCLAvailable)
<a name="l00113"></a>00113         thee-&gt;meth = 4;
<a name="l00114"></a>00114 <span class="preprocessor">#endif</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (thee-&gt;nonlin == NONLIN_LPBE) thee-&gt;ipkey = <a class="code" href="group___vhal.html#ggad16654551e609cdf34580c7722164d21a53245a979a96e2dc914a75f135104a62">IPKEY_LPBE</a>; <span class="comment">/* LPBE case */</span>
<a name="l00117"></a>00117     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(thee-&gt;nonlin == NONLIN_SMPBE) thee-&gt;ipkey = <a class="code" href="group___vhal.html#ggad16654551e609cdf34580c7722164d21a9cf856b3b07d357f63e8be09adc71a01">IPKEY_SMPBE</a>; <span class="comment">/* SMPBE case */</span>
<a name="l00118"></a>00118     <span class="keywordflow">else</span> thee-&gt;ipkey = <a class="code" href="group___vhal.html#ggad16654551e609cdf34580c7722164d21a59d9662a52d0c0862fffdfbc722a5eb0">IPKEY_NPBE</a>; <span class="comment">/* NPBE standard case */</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="comment">/* Default parameters */</span>
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (mgparm-&gt;setetol) { <span class="comment">/* If etol is set by the user in APBS input file, then use this custom-defined etol */</span>
<a name="l00122"></a>00122         thee-&gt;errtol = mgparm-&gt;etol;
<a name="l00123"></a>00123         Vnm_print(1, <span class="stringliteral">&quot;  Error tolerance (etol) is now set to user-defined \</span>
<a name="l00124"></a>00124 <span class="stringliteral">value: %g \n&quot;</span>, thee-&gt;errtol);
<a name="l00125"></a>00125         Vnm_print(0, <span class="stringliteral">&quot;Error tolerance (etol) is now set to user-defined \</span>
<a name="l00126"></a>00126 <span class="stringliteral">value: %g \n&quot;</span>, thee-&gt;errtol);
<a name="l00127"></a>00127     } <span class="keywordflow">else</span> thee-&gt;errtol = 1.0e-6;   <span class="comment">/* Here are a few comments.  Mike had this set to</span>
<a name="l00128"></a>00128 <span class="comment">        * 1e-9; convential wisdom sets this at 1e-6 for</span>
<a name="l00129"></a>00129 <span class="comment">        * the PBE; Ray Luo sets this at 1e-3 for his</span>
<a name="l00130"></a>00130 <span class="comment">        * accelerated PBE (for dynamics, etc.) */</span>
<a name="l00131"></a>00131     thee-&gt;itmax = 200;
<a name="l00132"></a>00132     thee-&gt;istop = 1;
<a name="l00133"></a>00133     thee-&gt;iinfo = 1;         <span class="comment">/* I&#39;d recommend either 1 (for debugging LPBE) or 2 (for debugging NPBE), higher values give too much output */</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     thee-&gt;bcfl = <a class="code" href="group___vhal.html#gga156281db9d201569da4620821ed24201a5b0fd9934f32bb7255ed6ebc373a6ad4">BCFL_SDH</a>;
<a name="l00136"></a>00136     thee-&gt;key = 0;
<a name="l00137"></a>00137     thee-&gt;iperf = 0;
<a name="l00138"></a>00138     thee-&gt;mgcoar = 2;
<a name="l00139"></a>00139     thee-&gt;mgkey = 0;
<a name="l00140"></a>00140     thee-&gt;nu1 = 2;
<a name="l00141"></a>00141     thee-&gt;nu2 = 2;
<a name="l00142"></a>00142     thee-&gt;mgprol = 0;
<a name="l00143"></a>00143     thee-&gt;mgdisc = 0;
<a name="l00144"></a>00144     thee-&gt;omegal = 19.4e-1;
<a name="l00145"></a>00145     thee-&gt;omegan = 9.0e-1;
<a name="l00146"></a>00146     thee-&gt;ipcon = 3;
<a name="l00147"></a>00147     thee-&gt;irite = 8;
<a name="l00148"></a>00148     thee-&gt;xcent = 0.0;
<a name="l00149"></a>00149     thee-&gt;ycent = 0.0;
<a name="l00150"></a>00150     thee-&gt;zcent = 0.0;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="comment">/* Default value for all APBS runs */</span>
<a name="l00153"></a>00153     thee-&gt;mgsmoo = 1;
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (thee-&gt;nonlin == NONLIN_NPBE || thee-&gt;nonlin == NONLIN_SMPBE) {
<a name="l00155"></a>00155         <span class="comment">/* SMPBE Added - SMPBE needs to mimic NPBE */</span>
<a name="l00156"></a>00156         Vnm_print(0, <span class="stringliteral">&quot;Vpmp_ctor2:  Using meth = 1, mgsolv = 0\n&quot;</span>);
<a name="l00157"></a>00157         thee-&gt;mgsolv = 0;
<a name="l00158"></a>00158     } <span class="keywordflow">else</span> {
<a name="l00159"></a>00159         <span class="comment">/* Most rigorous (good for testing) */</span>
<a name="l00160"></a>00160         Vnm_print(0, <span class="stringliteral">&quot;Vpmp_ctor2:  Using meth = 2, mgsolv = 1\n&quot;</span>);
<a name="l00161"></a>00161         thee-&gt;mgsolv = 1;
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="comment">/* TEMPORARY USEAQUA */</span>
<a name="l00165"></a>00165     <span class="comment">/* If we are using aqua, our solution method is either VSOL_CGMGAqua or VSOL_NewtonAqua</span>
<a name="l00166"></a>00166 <span class="comment">     * so we need to temporarily override the mgsolve value and set it to 0</span>
<a name="l00167"></a>00167 <span class="comment">     */</span>
<a name="l00168"></a>00168     <span class="keywordflow">if</span>(mgparm-&gt;useAqua == 1) thee-&gt;mgsolv = 0;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">return</span> 1;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00174"></a>00174 <span class="comment">// Routine:  Vpmgp_dtor</span>
<a name="l00175"></a>00175 <span class="comment">//</span>
<a name="l00176"></a>00176 <span class="comment">// Author:   Nathan Baker</span>
<a name="l00178"></a><a class="code" href="group___vpmgp.html#ga34b2134038fac6b41b02e67492105c07">00178</a> <span class="comment">VPUBLIC void Vpmgp_dtor(Vpmgp **thee) {</span>
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">    if ((*thee) != VNULL) {</span>
<a name="l00181"></a>00181 <span class="comment">        Vpmgp_dtor2(*thee);</span>
<a name="l00182"></a>00182 <span class="comment">        Vmem_free(VNULL, 1, sizeof(Vpmgp), (void **)thee);</span>
<a name="l00183"></a>00183 <span class="comment">        (*thee) = VNULL;</span>
<a name="l00184"></a>00184 <span class="comment">    }</span>
<a name="l00185"></a>00185 <span class="comment"></span>
<a name="l00186"></a>00186 <span class="comment">}</span>
<a name="l00187"></a>00187 <span class="comment"></span>
<a name="l00188"></a>00188 <span class="comment">/* ///////////////////////////////////////////////////////////////////////////</span>
<a name="l00189"></a>00189 <span class="comment">// Routine:  Vpmgp_dtor2</span>
<a name="l00190"></a>00190 <span class="comment">//</span>
<a name="l00191"></a>00191 <span class="comment">// Author:   Nathan Baker</span>
<a name="l00193"></a><a class="code" href="group___vpmgp.html#ga0362aaae83d2078bdb2e555a4b2fc00c">00193</a> <span class="comment">VPUBLIC void Vpmgp_dtor2(Vpmgp *thee) { ; }</span>
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment"></span>
<a name="l00196"></a><a class="code" href="group___vpmgp.html#gadb713e70f5724ce0f63ec4cf380278d7">00196</a> <span class="comment">VPUBLIC void Vpmgp_size(</span>
<a name="l00197"></a>00197 <span class="comment">    Vpmgp *thee</span>
<a name="l00198"></a>00198 <span class="comment">    )</span>
<a name="l00199"></a>00199 <span class="comment">{</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment">    int num_nf = 0;</span>
<a name="l00202"></a>00202 <span class="comment">    int num_narr = 2;</span>
<a name="l00203"></a>00203 <span class="comment">    int num_narrc = 27;</span>
<a name="l00204"></a>00204 <span class="comment">    int nxf, nyf, nzf, level, num_nf_oper, num_narrc_oper, n_band, nc_band, num_band, iretot;</span>
<a name="l00205"></a>00205 <span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment">    thee-&gt;nf = thee-&gt;nx * thee-&gt;ny * thee-&gt;nz;</span>
<a name="l00207"></a>00207 <span class="comment">    thee-&gt;narr = thee-&gt;nf;</span>
<a name="l00208"></a>00208 <span class="comment">    nxf = thee-&gt;nx;</span>
<a name="l00209"></a>00209 <span class="comment">    nyf = thee-&gt;ny;</span>
<a name="l00210"></a>00210 <span class="comment">    nzf = thee-&gt;nz;</span>
<a name="l00211"></a>00211 <span class="comment">    thee-&gt;nxc = thee-&gt;nx;</span>
<a name="l00212"></a>00212 <span class="comment">    thee-&gt;nyc = thee-&gt;ny;</span>
<a name="l00213"></a>00213 <span class="comment">    thee-&gt;nzc = thee-&gt;nz;</span>
<a name="l00214"></a>00214 <span class="comment"></span>
<a name="l00215"></a>00215 <span class="comment">    for (level=2; level&lt;=thee-&gt;nlev; level++) {</span>
<a name="l00216"></a>00216 <span class="comment">        Vpmgp_makeCoarse(1, nxf, nyf, nzf, &amp;(thee-&gt;nxc), &amp;(thee-&gt;nyc), &amp;(thee-&gt;nzc)); /* NAB TO-DO -- implement this function and check which variables need to be passed by reference... */</span>
<a name="l00217"></a>00217         nxf = thee-&gt;nxc;
<a name="l00218"></a>00218         nyf = thee-&gt;nyc;
<a name="l00219"></a>00219         nzf = thee-&gt;nzc;
<a name="l00220"></a>00220         thee-&gt;narr = thee-&gt;narr + (nxf * nyf * nzf);
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     thee-&gt;nc = thee-&gt;nxc * thee-&gt;nyc * thee-&gt;nzc;
<a name="l00224"></a>00224     thee-&gt;narrc = thee-&gt;narr - thee-&gt;nf;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">/* Box or FEM discretization on fine grid? */</span>
<a name="l00227"></a>00227     <span class="keywordflow">switch</span> (thee-&gt;mgdisc) { <span class="comment">/* NAB TO-DO:  This needs to be changed into an enumeration */</span>
<a name="l00228"></a>00228     <span class="keywordflow">case</span> 0:
<a name="l00229"></a>00229         num_nf_oper = 4;
<a name="l00230"></a>00230         <span class="keywordflow">break</span>;
<a name="l00231"></a>00231     <span class="keywordflow">case</span> 1:
<a name="l00232"></a>00232         num_nf_oper = 14;
<a name="l00233"></a>00233         <span class="keywordflow">break</span>;
<a name="l00234"></a>00234     <span class="keywordflow">default</span>:
<a name="l00235"></a>00235         Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_size:  Invalid mgdisc value (%d)!\n&quot;</span>, thee-&gt;mgdisc);
<a name="l00236"></a>00236         VASSERT(0);
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">/* Galerkin or standard coarsening? */</span>
<a name="l00240"></a>00240     <span class="keywordflow">switch</span> (thee-&gt;mgcoar) { <span class="comment">/* NAB TO-DO:  This needs to be changed into an enumeration */</span>
<a name="l00241"></a>00241     <span class="keywordflow">case</span> 0:
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (thee-&gt;mgdisc != 0) {
<a name="l00243"></a>00243             Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_size:  Invalid mgcoar value (%d); must be used with mgdisc 0!\n&quot;</span>, thee-&gt;mgcoar);
<a name="l00244"></a>00244             VASSERT(0);
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246         num_narrc_oper = 4;
<a name="l00247"></a>00247         <span class="keywordflow">break</span>;
<a name="l00248"></a>00248     <span class="keywordflow">case</span> 1:
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (thee-&gt;mgdisc != 0) {
<a name="l00250"></a>00250             Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_size:  Invalid mgcoar value (%d); must be used with mgdisc 0!\n&quot;</span>, thee-&gt;mgcoar);
<a name="l00251"></a>00251             VASSERT(0);
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253         num_narrc_oper = 14;
<a name="l00254"></a>00254         <span class="keywordflow">break</span>;
<a name="l00255"></a>00255     <span class="keywordflow">case</span> 2:
<a name="l00256"></a>00256         num_narrc_oper = 14;
<a name="l00257"></a>00257         <span class="keywordflow">break</span>;
<a name="l00258"></a>00258     <span class="keywordflow">default</span>:
<a name="l00259"></a>00259         Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_size:  Invalid mgcoar value (%d)!\n&quot;</span>, thee-&gt;mgcoar);
<a name="l00260"></a>00260         VASSERT(0);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">/* LINPACK storage on coarse grid */</span>
<a name="l00264"></a>00264     <span class="keywordflow">switch</span> (thee-&gt;mgsolv) { <span class="comment">/* NAB TO-DO:  This needs to be changed into an enumeration */</span>
<a name="l00265"></a>00265     <span class="keywordflow">case</span> 0:
<a name="l00266"></a>00266         n_band = 0;
<a name="l00267"></a>00267         <span class="keywordflow">break</span>;
<a name="l00268"></a>00268     <span class="keywordflow">case</span> 1:
<a name="l00269"></a>00269         <span class="keywordflow">if</span> ( ( (thee-&gt;mgcoar == 0) || (thee-&gt;mgcoar == 1)) &amp;&amp; (thee-&gt;mgdisc == 0) ) {
<a name="l00270"></a>00270             num_band = 1 + (thee-&gt;nxc-2)*(thee-&gt;nyc-2);
<a name="l00271"></a>00271         } <span class="keywordflow">else</span> {
<a name="l00272"></a>00272             num_band = 1 + (thee-&gt;nxc-2)*(thee-&gt;nyc-2) + (thee-&gt;nxc-2) + 1;
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         nc_band = (thee-&gt;nxc-2)*(thee-&gt;nyc-2)*(thee-&gt;nzc-2);
<a name="l00275"></a>00275         n_band  = nc_band * num_band;
<a name="l00276"></a>00276         <span class="keywordflow">break</span>;
<a name="l00277"></a>00277     <span class="keywordflow">default</span>:
<a name="l00278"></a>00278         Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_size:  Invalid mgsolv value (%d)!\n&quot;</span>, thee-&gt;mgsolv);
<a name="l00279"></a>00279         VASSERT(0);
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="comment">/* Real storage parameters */</span>
<a name="l00283"></a>00283     thee-&gt;n_rpc = 100*(thee-&gt;nlev+1);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="comment">/* Resulting total required for real storage */</span>
<a name="l00286"></a>00286     thee-&gt;nrwk = num_narr*thee-&gt;narr + (num_nf + num_nf_oper)*thee-&gt;nf + (num_narrc + num_narrc_oper)*thee-&gt;narrc + n_band + thee-&gt;n_rpc;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="comment">/* Integer storage parameters */</span>
<a name="l00289"></a>00289     thee-&gt;n_iz = 50*(thee-&gt;nlev+1);
<a name="l00290"></a>00290     thee-&gt;n_ipc = 100*(thee-&gt;nlev+1);
<a name="l00291"></a>00291     thee-&gt;niwk = thee-&gt;n_iz + thee-&gt;n_ipc;
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 VPRIVATE <span class="keywordtype">int</span> coarsenThis(<span class="keywordtype">int</span> nOld) {
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="keywordtype">int</span> nOut;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     nOut = (nOld - 1) / 2 + 1;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (((nOut-1)*2) != (nOld-1)) {
<a name="l00301"></a>00301         Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_makeCoarse:  Warning!  The grid dimensions you have chosen are not consistent with the nlev you have specified!\n&quot;</span>);
<a name="l00302"></a>00302         Vnm_print(2, <span class="stringliteral">&quot;Vpmgp_makeCoarse:  This calculation will only work if you are running with mg-dummy type.\n&quot;</span>);
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (nOut &lt; 1) {
<a name="l00305"></a>00305         Vnm_print(2, <span class="stringliteral">&quot;D&#39;oh!  You coarsened the grid below zero!  How did you do that?\n&quot;</span>);
<a name="l00306"></a>00306         VASSERT(0);
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="keywordflow">return</span> nOut;
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="group___vpmgp.html#ga0b65b886427a0d09e8ace8d117e7e0ea">00312</a> VPUBLIC <span class="keywordtype">void</span> <a class="code" href="group___vpmgp.html#ga0b65b886427a0d09e8ace8d117e7e0ea" title="Coarsen the grid by the desired number of levels and determine the resulting numbers of grid points...">Vpmgp_makeCoarse</a>(
<a name="l00313"></a>00313     <span class="keywordtype">int</span> numLevel,
<a name="l00314"></a>00314     <span class="keywordtype">int</span> nxOld,
<a name="l00315"></a>00315     <span class="keywordtype">int</span> nyOld,
<a name="l00316"></a>00316     <span class="keywordtype">int</span> nzOld,
<a name="l00317"></a>00317     <span class="keywordtype">int</span> *nxNew,
<a name="l00318"></a>00318     <span class="keywordtype">int</span> *nyNew,
<a name="l00319"></a>00319     <span class="keywordtype">int</span> *nzNew
<a name="l00320"></a>00320     )
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322     <span class="keywordtype">int</span> nxtmp, nytmp, nztmp, iLevel;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="keywordflow">for</span> (iLevel=0; iLevel&lt;numLevel; iLevel++) {
<a name="l00325"></a>00325         nxtmp = *nxNew;
<a name="l00326"></a>00326         nytmp = *nyNew;
<a name="l00327"></a>00327         nztmp = *nzNew;
<a name="l00328"></a>00328         *nxNew = coarsenThis(nxtmp);
<a name="l00329"></a>00329         *nyNew = coarsenThis(nytmp);
<a name="l00330"></a>00330         *nzNew = coarsenThis(nztmp);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="vpmgp_8c.html">vpmgp.c</a>      </li>

    <li class="footer">Generated on Wed Oct 17 2012 22:45:59 for APBS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
