<chapter id="gemstone-sect"> <title>Using APBS with Gemstone</title>
    <para> This section demonstrates how <ulink
            url="http://gemstone.mozdev.org">Gemstone</ulink> can be used to
        perform most APBS calculations commonly done through the command-line
        interface.  Better yet, it allows you to use <ulink
            url="http://nbcr.net">NBCR's</ulink> resources instead of your own!
    </para>

    <sect1> <title>Getting Gemstone</title>

        <para> As mentioned earlier, you need to download and install the Gemstone
            extension for the <ulink
                url="http://www.mozilla.com/firefox/">Firefox</ulink> web
            browser from <ulink
                url="http://gemstone.mozdev.org">http://gemstone.mozdev.org</ulink>
            before starting this tutorial.</para>
    </sect1>

    <sect1> <title>Preparing a structure with PDB2PQR</title>

        <para> We'll start by preparing a structure with <ulink
                url="http://pdb2pqr.sf.net">PDB2PQR</ulink>.  First, you need
            to download a PDB file from the <ulink
                url="http://www.pdb.org">Protein Data Bank</ulink>.  For the
            purposes of this example, we'll use <ulink
                url="http://www.pdb.org/pdb/navbarsearch.do?newSearch=yes&amp;inputQuickSearch=1fas">1FAS</ulink>
            in PDB format (download directly <ulink
                url="http://www.pdb.org/pdb/downloadFile.do?fileFormat=pdb&amp;compression=NO&amp;structureId=1FAS">here</ulink>).
        </para>
        <para>
            Open the Gemstone interface through the Firefox menu 
            <menuchoice>
                <guimenu>Tools</guimenu>
                <guimenuitem>Gemstone</guimenuitem>
            </menuchoice>.  
            Select the PDB2PQR application through the Gemstone menu
            <menuchoice>
                <guimenu>Utils</guimenu>
                <guimenuitem>PDB2PQR</guimenuitem>
            </menuchoice>
            on the righthand side of the Gemstone screen.  Select the PDB file
            you just downloaded and any other options for PDB2PQR of interest.
            Your screen should look something like: 
            <figure> <title>Gemstone PDB2PQR calculation</title> 
                <graphic fileref="images/gemstone-pdb2pqr.png"></graphic> 
            </figure>
            Go ahead and "Run" the Gemstone calculation, check the
            <filename>stdOut</filename> and <filename>stdErr</filename> for any
            warning messages, and download the resulting PQR file.
        </para>

    </sect1>

    <sect1> <title>Perform an electrostatics calculation with APBS</title>

        <para>We're now ready to perform an APBS calculation of the 1FAS
            electrostatic potential through Gemstone.  Open the 
            <menuchoice>
                <guimenu>Chemistry</guimenu>
                <guimenuitem>Apbs</guimenuitem>
            </menuchoice>
            menu on the righthand side of the Gemstone screen.  We'll step
            through each of the input tabs in the middle pane in the following
            sections.
        </para>

        <sect2> <title>Calculation</title> 
            
            <para>Move to the Calculation tab in the middle pane.</para>

            <para>Most of the "Mathematics" settings can be left as-is;
                however, feel free to play with the discretization and surface
                definitions to see how it affects your results.</para>
            
            <para>Under "Molecules", load the 1FAS PQR file you just prepared
                in the previous section.</para>
            
            <para>Don't select anything under "Energy and Force" for this
                calculation.</para>
            
            <para>At this point, your screen should look something like this:
                <figure> <title>Gemstone APBS/Calculation screen</title>
                    <graphic fileref="images/gemstone-apbs-calculation.png"/>
                </figure> 
            </para>

        </sect2>

        <sect2> <title>Grid</title>

            <para>Next, move to the Grid tab in the middle pane.</para>

            <para>Under "General", enter 97 for X, Y, and Z "Grid points".</para>

            <para>Under "Coarse Grid", choose 100 for all X, Y, and Z
                "Lengths".  Center the mesh on the molecule.</para>

            <para>Under "Fine Grid", choose 80 for all X, Y, and Z
                "Lengths".  Center the mesh on the molecule.</para>

            <para>Leave the "Parallel Execution" alone for this
                calculation.</para>

            <para>At this point, your screen should look something like this:
                <figure> <title>Gemstone APBS/Grid screen</title>
                    <graphic fileref="images/gemstone-apbs-grid.png"/>
                </figure> 
            </para>

        </sect2>

        <sect2> <title>Physics</title>

            <para>Next, move to the Physics tab in the middle pane.</para>

            <para>Choose any values you like here; the defaults should be fine
                for most visualization calculations.</para>

            <para>At this point, your screen should look something like this:
                <figure> <title>Gemstone APBS/Physics screen</title>
                    <graphic fileref="images/gemstone-apbs-physics.png"/>
                </figure> 
            </para>

        </sect2>

        <sect2> <title>File I/O </title>

            <para>Next, move to the File I/O tab in the middle pane.</para>

            <para>Unless you have other properties you wan to visualize, you
                can leave these settings as-is.</para>

            <para>At this point, your screen should look something like this:
                <figure> <title>Gemstone APBS/File I/O screen</title>
                    <graphic fileref="images/gemstone-apbs-file.png"/>
                </figure> 
            </para>

        </sect2>

        <sect2> <title>Running the calculation</title>

            <para>Finally, return to the Calculation tab and select "Run APBS".
                After a while, the results will appear under the Output tab in
                the middle pane.  When the run is complete, you should see
                something like this:
                <figure> <title>Gemstone APBS/Calculation screen (run complete)</title>
                    <graphic fileref="images/gemstone-apbs-finished.png"/>
                </figure> 
                In particular, you should have the option to save the potential
                file calculated in this APBS run.  
            </para>

        </sect2>

        <sect1> <title>Other calculations</title>

            <para>Nearly all of the examples in this tutorial can also be
                performed with Gemstone.  Furthermore, input files can be
                uploaded to use Gemstone as a "portal" to web services at other
                institutions.
            </para>

        </sect2>

    </sect1>

</chapter>
